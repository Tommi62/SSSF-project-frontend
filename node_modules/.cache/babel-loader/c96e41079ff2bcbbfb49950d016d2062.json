{"ast":null,"code":"var _jsxFileName = \"/Users/tommivainio/Desktop/chatApp/my-app/src/views/home.tsx\",\n    _s = $RefreshSig$();\n\n/* eslint-disable react-hooks/exhaustive-deps */\nimport { Grid, List, Typography } from '@material-ui/core';\nimport { useContext, useEffect, useState } from 'react';\nimport Thread from '../components/thread';\nimport ThreadButton from '../components/threadButton';\nimport { MediaContext } from '../contexts/mediaContext';\nimport { useUsers, useChats } from '../hooks/apiHooks';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Home = ({\n  history\n}) => {\n  _s();\n\n  const {\n    user,\n    setUser\n  } = useContext(MediaContext);\n  const {\n    getIsLoggedIn\n  } = useUsers();\n  const {\n    getThreadIds,\n    getMessages\n  } = useChats();\n  const [threads, setThreads] = useState([]);\n  const [threadOpen, setThreadOpen] = useState(false);\n  const [threadId, setThreadId] = useState(0);\n  const [messages, setMessages] = useState([]);\n  const [webSocketUpdate, setWebSocketUpdate] = useState('');\n  const [websocket, setWebsocket] = useState();\n  const [socketThreadId, setSocketThreadId] = useState(0);\n  useEffect(() => {\n    (async () => {\n      try {\n        console.log('USER: ', user);\n        const isLoggedIn = await getIsLoggedIn();\n\n        if (!isLoggedIn.success) {\n          history.push('/login');\n        }\n\n        setUser(isLoggedIn.id);\n        console.log('Logged user: ', user, isLoggedIn.id);\n\n        if (user !== 0) {\n          const chatThreads = await getThreadIds(isLoggedIn.id);\n          setThreads(chatThreads);\n        }\n      } catch (e) {\n        console.log(e.message);\n      }\n    })();\n  }, [user]);\n  useEffect(() => {\n    (async () => {\n      try {\n        if (threadId !== 0) {\n          const threadMessages = await getMessages(threadId);\n          setMessages(threadMessages);\n          console.log('USEEFFECT');\n        }\n      } catch (e) {\n        console.log(e.message);\n      }\n    })();\n  }, [threadId, webSocketUpdate]);\n  useEffect(() => {\n    try {\n      if (threadOpen) {\n        if (websocket === undefined || websocket.readyState === 2 || websocket.readyState === 3 || threadId !== socketThreadId) {\n          console.log('READYSTATE ', websocket === null || websocket === void 0 ? void 0 : websocket.readyState);\n          const socket = new WebSocket('ws://localhost:3001');\n          socket.addEventListener('open', function (event) {\n            console.log('Server is opened.');\n            const client = {\n              type: 'client',\n              thread_id: threadId,\n              user_id: user\n            };\n            socket.send(JSON.stringify(client));\n          });\n          socket.addEventListener('message', function (event) {\n            console.log('Message from server ', JSON.parse(event.data).thread_id);\n            const message = JSON.parse(event.data);\n\n            if (message.thread_id === threadId) {\n              setWebSocketUpdate(message.timestamp);\n            }\n          });\n          socket.addEventListener('close', function (event) {\n            console.log('Websocket connection closed.');\n          });\n          setWebsocket(socket);\n          setSocketThreadId(threadId);\n          console.log('NEW SOCKET');\n        }\n      } else {\n        if (websocket !== undefined) {\n          console.log('CLOSE');\n          websocket.close();\n        }\n      }\n    } catch (e) {\n      console.log(e.message);\n    }\n\n    ;\n  }, [threadOpen, threadId]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: threadOpen ? /*#__PURE__*/_jsxDEV(Grid, {\n      container: true,\n      direction: \"row\",\n      children: [/*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        style: {\n          width: '30%'\n        },\n        children: /*#__PURE__*/_jsxDEV(List, {\n          children: [threads.map(item => /*#__PURE__*/_jsxDEV(ThreadButton, {\n            id: item.thread_id,\n            setThreadOpen: setThreadOpen,\n            setThreadId: setThreadId,\n            threadOpen: threadOpen\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 124,\n            columnNumber: 33\n          }, this)), ' ']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        style: {\n          width: '70%'\n        },\n        children: /*#__PURE__*/_jsxDEV(Thread, {\n          messages: messages,\n          id: threadId,\n          setWebSocketUpdate: setWebSocketUpdate,\n          websocket: websocket\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 17\n    }, this) : /*#__PURE__*/_jsxDEV(Grid, {\n      container: true,\n      justify: \"center\",\n      direction: \"column\",\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        component: \"h1\",\n        variant: \"h2\",\n        children: \"Welcome\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(List, {\n        children: [threads.map(item => /*#__PURE__*/_jsxDEV(ThreadButton, {\n          id: item.thread_id,\n          setThreadOpen: setThreadOpen,\n          setThreadId: setThreadId,\n          threadOpen: threadOpen\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 29\n        }, this)), ' ']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 17\n    }, this)\n  }, void 0, false);\n};\n\n_s(Home, \"bPPuc14DubkmlnlH6OHwPFFo47c=\", false, function () {\n  return [useUsers, useChats];\n});\n\n_c = Home;\nexport default Home;\n\nvar _c;\n\n$RefreshReg$(_c, \"Home\");","map":{"version":3,"sources":["/Users/tommivainio/Desktop/chatApp/my-app/src/views/home.tsx"],"names":["Grid","List","Typography","useContext","useEffect","useState","Thread","ThreadButton","MediaContext","useUsers","useChats","Home","history","user","setUser","getIsLoggedIn","getThreadIds","getMessages","threads","setThreads","threadOpen","setThreadOpen","threadId","setThreadId","messages","setMessages","webSocketUpdate","setWebSocketUpdate","websocket","setWebsocket","socketThreadId","setSocketThreadId","console","log","isLoggedIn","success","push","id","chatThreads","e","message","threadMessages","undefined","readyState","socket","WebSocket","addEventListener","event","client","type","thread_id","user_id","send","JSON","stringify","parse","data","timestamp","close","width","map","item"],"mappings":"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","sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\nimport { Grid, List, Typography } from '@material-ui/core';\nimport { useContext, useEffect, useState } from 'react';\nimport Thread from '../components/thread';\nimport ThreadButton from '../components/threadButton';\nimport { MediaContext } from '../contexts/mediaContext';\nimport { useUsers, useChats } from '../hooks/apiHooks';\n\ninterface propType {\n    history: {\n        push: Function,\n    }\n}\n\ninterface threadsArray {\n    thread_id: number\n}\n\ninterface messagesArray {\n    id: number,\n    user_id: number,\n    contents: string,\n    timestamp: Date,\n}\n\nconst Home = ({ history }: propType) => {\n    const { user, setUser } = useContext(MediaContext);\n    const { getIsLoggedIn } = useUsers();\n    const { getThreadIds, getMessages } = useChats();\n    const [threads, setThreads] = useState<threadsArray[]>([]);\n    const [threadOpen, setThreadOpen] = useState(false)\n    const [threadId, setThreadId] = useState(0)\n    const [messages, setMessages] = useState<messagesArray[]>([]);\n    const [webSocketUpdate, setWebSocketUpdate] = useState('');\n    const [websocket, setWebsocket] = useState<WebSocket>();\n    const [socketThreadId, setSocketThreadId] = useState(0);\n\n    useEffect(() => {\n        (async () => {\n            try {\n                console.log('USER: ', user)\n                const isLoggedIn = await getIsLoggedIn();\n                if (!isLoggedIn.success) {\n                    history.push('/login');\n                }\n                setUser(isLoggedIn.id)\n                console.log('Logged user: ', user, isLoggedIn.id);\n                if (user !== 0) {\n                    const chatThreads = await getThreadIds(isLoggedIn.id)\n                    setThreads(chatThreads)\n                }\n            } catch (e) {\n                console.log(e.message);\n            }\n        })();\n    }, [user]);\n\n    useEffect(() => {\n        (async () => {\n            try {\n                if (threadId !== 0) {\n                    const threadMessages = await getMessages(threadId);\n                    setMessages(threadMessages);\n                    console.log('USEEFFECT');\n                }\n            } catch (e) {\n                console.log(e.message);\n            }\n        })();\n    }, [threadId, webSocketUpdate]);\n\n    useEffect(() => {\n        try {\n            if (threadOpen) {\n                if (websocket === undefined || websocket.readyState === 2 || websocket.readyState === 3 || threadId !== socketThreadId) {\n                    console.log('READYSTATE ', websocket?.readyState)\n                    const socket = new WebSocket('ws://localhost:3001');\n\n                    socket.addEventListener('open', function (event) {\n                        console.log('Server is opened.');\n                        const client = {\n                            type: 'client',\n                            thread_id: threadId,\n                            user_id: user,\n                        }\n                        socket.send(JSON.stringify(client));\n                    });\n\n                    socket.addEventListener('message', function (event) {\n                        console.log('Message from server ', JSON.parse(event.data).thread_id);\n                        const message = JSON.parse(event.data);\n                        if (message.thread_id === threadId) {\n                            setWebSocketUpdate(message.timestamp);\n                        }\n                    });\n\n                    socket.addEventListener('close', function (event) {\n                        console.log('Websocket connection closed.');\n                    });\n\n                    setWebsocket(socket);\n                    setSocketThreadId(threadId);\n                    console.log('NEW SOCKET');\n                }\n            } else {\n                if (websocket !== undefined) {\n                    console.log('CLOSE');\n                    websocket.close();\n                }\n            }\n        } catch (e) {\n            console.log(e.message);\n        };\n    }, [threadOpen, threadId]);\n\n\n    return (\n        <>\n            {threadOpen ? (\n                <Grid container direction=\"row\">\n                    <Grid item style={{ width: '30%' }}>\n                        <List>\n                            {threads.map((item) => (\n                                <ThreadButton id={item.thread_id} setThreadOpen={setThreadOpen} setThreadId={setThreadId} threadOpen={threadOpen} />\n                            ))}{' '}\n                        </List>\n                    </Grid>\n                    <Grid item style={{ width: '70%' }}>\n                        <Thread messages={messages} id={threadId} setWebSocketUpdate={setWebSocketUpdate} websocket={websocket} />\n                    </Grid>\n                </Grid>\n            ) : (\n                <Grid container justify=\"center\" direction=\"column\">\n                    <Typography component=\"h1\" variant=\"h2\">Welcome</Typography>\n                    <List>\n                        {threads.map((item) => (\n                            <ThreadButton id={item.thread_id} setThreadOpen={setThreadOpen} setThreadId={setThreadId} threadOpen={threadOpen} />\n                        ))}{' '}\n                    </List>\n                </Grid>\n            )}\n        </>\n    );\n\n}\n\nexport default Home"]},"metadata":{},"sourceType":"module"}