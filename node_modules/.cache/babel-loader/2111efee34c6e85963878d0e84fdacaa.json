{"ast":null,"code":"import config from '../config';\n\nconst doFetch = async (url, options = {}) => {\n  const response = await fetch(config.backendUrl + url, options);\n  const json = await response.json();\n\n  if (json.error) {\n    // if API response contains error message (use Postman to get further details)\n    throw new Error(json.message + ': ' + json.error);\n  } else if (!response.ok) {\n    // if API response does not contain error message, but there is some other error\n    throw new Error('doFetch failed');\n  } else {\n    // if all goes well\n    return json;\n  }\n};\n\nconst doQueryFetch = async (query, token) => {\n  let options = {};\n\n  if (token !== 'no token') {\n    options = {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json',\n        'Authorization': `Bearer ${token}`\n      },\n      body: JSON.stringify(query)\n    };\n  } else {\n    options = {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json'\n      },\n      body: JSON.stringify(query)\n    };\n  }\n\n  try {\n    const response = await fetch(config.backendUrl, options);\n    const json = await response.json();\n    return json;\n  } catch (e) {\n    console.log(e);\n    return false;\n  }\n};\n\nconst useUsers = () => {\n  const getUsers = async () => {\n    const fetchOptions = {\n      method: 'GET',\n      credentials: 'include'\n    };\n\n    try {\n      return await doFetch('/users', fetchOptions);\n    } catch (e) {\n      throw new Error(e.message);\n    }\n  };\n\n  const getUserAvailable = async username => {\n    try {\n      return await doFetch('/users/username/' + username);\n    } catch (e) {\n      alert(e.message);\n    }\n  };\n\n  const getUsernameById = async id => {\n    try {\n      return await doFetch('/user/' + id);\n    } catch (e) {\n      alert(e.message);\n    }\n  };\n\n  const register = async inputs => {\n    const fetchOptions = {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(inputs),\n      credentials: 'include'\n    };\n\n    try {\n      const result = await doFetch('/user', fetchOptions);\n      console.log('RegisterResult', result.message);\n      return result.message;\n    } catch (e) {\n      alert(e.message);\n    }\n  };\n\n  const getLoggedInUser = async token => {\n    try {\n      const query = {\n        query: `\n                {\n                  getLoggedInUser{\n                    id\n                    username\n                  }\n                }\n                `\n      };\n      const data = await doQueryFetch(query, token);\n      console.log('DATA', data);\n      let success = true;\n\n      if (data.errors) {\n        success = false;\n      }\n\n      const returnObject = {\n        success,\n        data: data.data.getLoggedInUser\n      };\n      return returnObject;\n    } catch (e) {\n      throw new Error(e.message);\n    }\n  };\n\n  const postLogin = async inputs => {\n    try {\n      const query = {\n        query: `\n                {\n                    login(username: \"${inputs.username}\", password: \"${inputs.password}\") {\n                        id,\n                        username,\n                        token\n                    }\n                }\n                `,\n        variables: inputs\n      };\n      const data = await doQueryFetch(query, 'no token');\n      let success = true;\n\n      if (data.errors) {\n        success = false;\n      }\n\n      const returnObject = {\n        success,\n        data: data.data.login\n      };\n      return returnObject;\n    } catch (e) {\n      alert(e.message);\n    }\n  };\n\n  const logout = async () => {\n    const fetchOptions = {\n      method: 'DELETE',\n      credentials: 'include'\n    };\n\n    try {\n      return await doFetch('/logout', fetchOptions);\n    } catch (e) {\n      throw new Error(e.message);\n    }\n  };\n\n  const getProfile = async () => {\n    const fetchOptions = {\n      method: 'GET',\n      credentials: 'include'\n    };\n\n    try {\n      return await doFetch('/profile', fetchOptions);\n    } catch (e) {\n      throw new Error(e.message);\n    }\n  };\n\n  return {\n    getUsers,\n    getUserAvailable,\n    getUsernameById,\n    register,\n    getLoggedInUser,\n    postLogin,\n    logout,\n    getProfile\n  };\n};\n\nconst useChats = () => {\n  const getThreadIds = async userId => {\n    try {\n      return await doFetch('/threads/' + userId);\n    } catch (e) {\n      alert(e.message);\n    }\n  };\n\n  const getThreads = async token => {\n    try {\n      const query = {\n        query: `\n                {\n                    getChatThreadsByUserId {\n                        thread {\n                            id,\n                            name,\n                            private,\n                            creator {\n                                username\n                            }\n                        }\n                    }\n                }\n                `\n      };\n      const data = await doQueryFetch(query, token);\n      console.log('DATA', data);\n      let message = 'Success';\n\n      if (data.errors) {\n        console.log(data.errors[0]);\n        message = data.errors[0].message;\n      }\n\n      const returnObject = {\n        message,\n        data: data.data.getChatThreadsByUserId\n      };\n      return returnObject;\n    } catch (e) {\n      console.log(e.message);\n      const returnObject = {\n        message: e.message,\n        data: null\n      };\n      return returnObject;\n    }\n  };\n\n  const getMessages = async (threadId, token) => {\n    try {\n      const query = {\n        query: `\n                {\n                    getMessagesByThreadId(id: \"${threadId}\") {\n                        id,\n                        contents,\n                        timestamp,\n                        status,\n                        thread {\n                            id,\n                            name\n                        },\n                        user {\n                            id,\n                            username\n                        }\n                    }\n                }\n                `,\n        variables: threadId\n      };\n      const data = await doQueryFetch(query, token);\n      console.log('DATA', data);\n      let message = 'Success';\n\n      if (data.errors) {\n        console.log(data.errors[0]);\n        message = data.errors[0].message;\n      }\n\n      const returnObject = {\n        message,\n        data: data.data.getMessagesByThreadId\n      };\n      return returnObject;\n    } catch (e) {\n      console.log(e.message);\n      const returnObject = {\n        message: e.message,\n        data: null\n      };\n      return returnObject;\n    }\n  };\n\n  const getLastMessage = async (threadId, token) => {\n    try {\n      const query = {\n        query: `\n                {\n                    getLastMessageByThreadId(id: \"${threadId}\") {\n                        id,\n                        contents,\n                        timestamp,\n                        status,\n                        thread {\n                            id,\n                            name\n                        },\n                        user {\n                            id,\n                            username\n                        }\n                    }\n                }\n                `,\n        variables: threadId\n      };\n      const data = await doQueryFetch(query, token);\n      console.log('DATA', data);\n      let message = 'Success';\n\n      if (data.errors) {\n        console.log(data.errors[0]);\n        message = data.errors[0].message;\n      }\n\n      const returnObject = {\n        message,\n        data: data.data.getLastMessageByThreadId\n      };\n      return returnObject;\n    } catch (e) {\n      console.log(e.message);\n      const returnObject = {\n        message: e.message,\n        data: null\n      };\n      return returnObject;\n    }\n  };\n\n  const getUserIds = async userId => {\n    try {\n      return await doFetch('/threadusers/' + userId);\n    } catch (e) {\n      alert(e.message);\n    }\n  };\n\n  const getThreadName = async threadId => {\n    try {\n      const thread = await doFetch('/thread/' + threadId);\n      return thread.name;\n    } catch (e) {\n      alert(e.message);\n    }\n  };\n\n  const postMessage = async messageObject => {\n    const fetchOptions = {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: messageObject,\n      credentials: 'include'\n    };\n\n    try {\n      const result = await doFetch('/message', fetchOptions);\n      return result.success;\n    } catch (e) {\n      alert(e.message);\n    }\n  };\n\n  const getAllMessages = async threadId => {\n    try {\n      return await doFetch('/all_messages/' + threadId);\n    } catch (e) {\n      alert(e.message);\n    }\n  };\n\n  const createNewChatThread = async chatThreadObject => {\n    const fetchOptions = {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: chatThreadObject,\n      credentials: 'include'\n    };\n\n    try {\n      const result = await doFetch('/new_thread', fetchOptions);\n      return result;\n    } catch (e) {\n      alert(e.message);\n    }\n  };\n\n  return {\n    getThreadIds,\n    getUserIds,\n    getThreadName,\n    postMessage,\n    getMessages,\n    getAllMessages,\n    getLastMessage,\n    createNewChatThread,\n    getThreads\n  };\n};\n\nexport { useUsers, useChats };","map":{"version":3,"sources":["/Users/tommivainio/SSSF/SSSF-project-frontend/src/hooks/apiHooks.tsx"],"names":["config","doFetch","url","options","response","fetch","backendUrl","json","error","Error","message","ok","doQueryFetch","query","token","method","headers","body","JSON","stringify","e","console","log","useUsers","getUsers","fetchOptions","credentials","getUserAvailable","username","alert","getUsernameById","id","register","inputs","result","getLoggedInUser","data","success","errors","returnObject","postLogin","password","variables","login","logout","getProfile","useChats","getThreadIds","userId","getThreads","getChatThreadsByUserId","getMessages","threadId","getMessagesByThreadId","getLastMessage","getLastMessageByThreadId","getUserIds","getThreadName","thread","name","postMessage","messageObject","getAllMessages","createNewChatThread","chatThreadObject"],"mappings":"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","sourcesContent":["import config from '../config'\r\n\r\ninterface fetchQuery {\r\n    query: string\r\n}\r\n\r\ninterface inputsObject {\r\n    username: string,\r\n    password: string\r\n}\r\n\r\nconst doFetch = async (url: string, options = {}) => {\r\n    const response = await fetch(config.backendUrl + url, options);\r\n    const json = await response.json();\r\n    if (json.error) {\r\n        // if API response contains error message (use Postman to get further details)\r\n        throw new Error(json.message + ': ' + json.error);\r\n    } else if (!response.ok) {\r\n        // if API response does not contain error message, but there is some other error\r\n        throw new Error('doFetch failed');\r\n    } else {\r\n        // if all goes well\r\n        return json;\r\n    }\r\n};\r\n\r\nconst doQueryFetch = async (query: fetchQuery, token: string) => {\r\n    let options = {};\r\n    \r\n    if (token !== 'no token') {\r\n        options = {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Accept': 'application/json',\r\n            'Authorization': `Bearer ${token}`,\r\n          },\r\n          body: JSON.stringify(query),\r\n        };\r\n    } else {\r\n      options = {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Accept': 'application/json',\r\n          },\r\n          body: JSON.stringify(query),\r\n        };\r\n    }\r\n    try {\r\n      const response = await fetch(config.backendUrl, options);\r\n      const json = await response.json();\r\n      return json;\r\n    }\r\n    catch (e) {\r\n      console.log(e);\r\n      return false;\r\n    }\r\n};\r\n\r\nconst useUsers = () => {\r\n\r\n    const getUsers = async () => {\r\n        const fetchOptions = {\r\n            method: 'GET',\r\n            credentials: 'include',\r\n        };\r\n        try {\r\n            return await doFetch('/users', fetchOptions);\r\n        } catch (e) {\r\n            throw new Error(e.message);\r\n        }\r\n    };\r\n\r\n    const getUserAvailable = async (username: String) => {\r\n        try {\r\n            return await doFetch('/users/username/' + username);\r\n        } catch (e) {\r\n            alert(e.message);\r\n        }\r\n    };\r\n\r\n    const getUsernameById = async (id: number) => {\r\n        try {\r\n            return await doFetch('/user/' + id);\r\n        } catch (e) {\r\n            alert(e.message);\r\n        }\r\n    };\r\n\r\n    const register = async (inputs: Object) => {\r\n        const fetchOptions = {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n            },\r\n            body: JSON.stringify(inputs),\r\n            credentials: 'include',\r\n        };\r\n        try {\r\n            const result = await doFetch('/user', fetchOptions);\r\n            console.log('RegisterResult', result.message)\r\n            return result.message\r\n        } catch (e) {\r\n            alert(e.message);\r\n        }\r\n    };\r\n\r\n    const getLoggedInUser = async (token: string) => {\r\n        try {\r\n            const query = {\r\n                query: `\r\n                {\r\n                  getLoggedInUser{\r\n                    id\r\n                    username\r\n                  }\r\n                }\r\n                `\r\n              };\r\n              const data = await doQueryFetch(query, token);\r\n              console.log('DATA', data);\r\n              let success = true;\r\n              if (data.errors) {\r\n                success = false;\r\n              }\r\n              const returnObject = {\r\n                  success,\r\n                  data: data.data.getLoggedInUser\r\n              }\r\n              return returnObject;\r\n        } catch (e) {\r\n            throw new Error(e.message);\r\n        }\r\n    };\r\n\r\n    const postLogin = async (inputs: inputsObject) => {\r\n        try {\r\n            const query = {\r\n                query: `\r\n                {\r\n                    login(username: \"${inputs.username}\", password: \"${inputs.password}\") {\r\n                        id,\r\n                        username,\r\n                        token\r\n                    }\r\n                }\r\n                `,\r\n                variables: inputs\r\n              };\r\n              const data = await doQueryFetch(query, 'no token');\r\n              let success = true;\r\n              if (data.errors) {\r\n                success = false;\r\n              }\r\n              const returnObject = {\r\n                  success,\r\n                  data: data.data.login\r\n              }\r\n              return returnObject;\r\n        } catch (e) {\r\n            alert(e.message);\r\n        }\r\n    };\r\n\r\n    const logout = async () => {\r\n        const fetchOptions = {\r\n            method: 'DELETE',\r\n            credentials: 'include',\r\n        };\r\n        try {\r\n            return await doFetch('/logout', fetchOptions);\r\n        } catch (e) {\r\n            throw new Error(e.message);\r\n        }\r\n    }\r\n\r\n    const getProfile = async () => {\r\n        const fetchOptions = {\r\n            method: 'GET',\r\n            credentials: 'include',\r\n        };\r\n        try {\r\n            return await doFetch('/profile', fetchOptions);\r\n        } catch (e) {\r\n            throw new Error(e.message);\r\n        }\r\n    };\r\n\r\n    return { getUsers, getUserAvailable, getUsernameById, register, getLoggedInUser, postLogin, logout, getProfile };\r\n};\r\n\r\nconst useChats = () => {\r\n\r\n    const getThreadIds = async (userId: number) => {\r\n        try {\r\n            return await doFetch('/threads/' + userId);\r\n        } catch (e) {\r\n            alert(e.message);\r\n        }\r\n    };\r\n\r\n    const getThreads = async (token: string) => {\r\n        try {\r\n            const query = {\r\n                query: `\r\n                {\r\n                    getChatThreadsByUserId {\r\n                        thread {\r\n                            id,\r\n                            name,\r\n                            private,\r\n                            creator {\r\n                                username\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                `\r\n              };\r\n              const data = await doQueryFetch(query, token);\r\n              console.log('DATA', data);\r\n              let message = 'Success';\r\n              if (data.errors) {\r\n                console.log(data.errors[0]);\r\n                message = data.errors[0].message;\r\n              }\r\n              const returnObject = {\r\n                  message,\r\n                  data: data.data.getChatThreadsByUserId\r\n              }\r\n              return returnObject;\r\n        } catch (e) {\r\n            console.log(e.message);\r\n            const returnObject = {\r\n                message: e.message,\r\n                data: null,\r\n            }\r\n            return returnObject;\r\n        }\r\n    };\r\n\r\n    const getMessages = async (threadId: string, token: string) => {\r\n        try {\r\n            const query = {\r\n                query: `\r\n                {\r\n                    getMessagesByThreadId(id: \"${threadId}\") {\r\n                        id,\r\n                        contents,\r\n                        timestamp,\r\n                        status,\r\n                        thread {\r\n                            id,\r\n                            name\r\n                        },\r\n                        user {\r\n                            id,\r\n                            username\r\n                        }\r\n                    }\r\n                }\r\n                `,\r\n                variables: threadId\r\n              };\r\n              const data = await doQueryFetch(query, token);\r\n              console.log('DATA', data);\r\n              let message = 'Success';\r\n              if (data.errors) {\r\n                console.log(data.errors[0]);\r\n                message = data.errors[0].message;\r\n              }\r\n              const returnObject = {\r\n                  message,\r\n                  data: data.data.getMessagesByThreadId\r\n              }\r\n              return returnObject;\r\n        } catch (e) {\r\n            console.log(e.message);\r\n            const returnObject = {\r\n                message: e.message,\r\n                data: null,\r\n            }\r\n            return returnObject;\r\n        }\r\n    };\r\n\r\n    const getLastMessage = async (threadId: string, token: string) => {\r\n        try {\r\n            const query = {\r\n                query: `\r\n                {\r\n                    getLastMessageByThreadId(id: \"${threadId}\") {\r\n                        id,\r\n                        contents,\r\n                        timestamp,\r\n                        status,\r\n                        thread {\r\n                            id,\r\n                            name\r\n                        },\r\n                        user {\r\n                            id,\r\n                            username\r\n                        }\r\n                    }\r\n                }\r\n                `,\r\n                variables: threadId\r\n              };\r\n              const data = await doQueryFetch(query, token);\r\n              console.log('DATA', data);\r\n              let message = 'Success';\r\n              if (data.errors) {\r\n                console.log(data.errors[0]);\r\n                message = data.errors[0].message;\r\n              }\r\n              const returnObject = {\r\n                  message,\r\n                  data: data.data.getLastMessageByThreadId\r\n              }\r\n              return returnObject;\r\n        } catch (e) {\r\n            console.log(e.message);\r\n            const returnObject = {\r\n                message: e.message,\r\n                data: null,\r\n            }\r\n            return returnObject;\r\n        }\r\n    };\r\n\r\n    const getUserIds = async (userId: number) => {\r\n        try {\r\n            return await doFetch('/threadusers/' + userId);\r\n        } catch (e) {\r\n            alert(e.message);\r\n        }\r\n    };\r\n\r\n    const getThreadName = async (threadId: number) => {\r\n        try {\r\n            const thread = await doFetch('/thread/' + threadId);\r\n            return thread.name;\r\n        } catch (e) {\r\n            alert(e.message);\r\n        }\r\n    };\r\n\r\n    const postMessage = async (messageObject: Object) => {\r\n        const fetchOptions = {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n            },\r\n            body: messageObject,\r\n            credentials: 'include',\r\n        };\r\n        try {\r\n            const result = await doFetch('/message', fetchOptions);\r\n            return result.success\r\n        } catch (e) {\r\n            alert(e.message);\r\n        }\r\n    };\r\n\r\n    const getAllMessages = async (threadId: number) => {\r\n        try {\r\n            return await doFetch('/all_messages/' + threadId);\r\n        } catch (e) {\r\n            alert(e.message);\r\n        }\r\n    };\r\n\r\n    const createNewChatThread = async (chatThreadObject: Object) => {\r\n        const fetchOptions = {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n            },\r\n            body: chatThreadObject,\r\n            credentials: 'include',\r\n        };\r\n        try {\r\n            const result = await doFetch('/new_thread', fetchOptions);\r\n            return result\r\n        } catch (e) {\r\n            alert(e.message);\r\n        }\r\n    };\r\n\r\n    return { getThreadIds, getUserIds, getThreadName, postMessage, getMessages, getAllMessages, getLastMessage, createNewChatThread, getThreads }\r\n}\r\n\r\nexport { useUsers, useChats };"]},"metadata":{},"sourceType":"module"}